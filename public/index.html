<html>
<head>
  <title>livepoll</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"> </script>
  <script>
    var w, h;
    $(document).ready(function() {
      w = $(document).width();
      h = $(document).height();
    });
    $(document).resize(function() {
      w = $(document).width();
      h = $(document).height();
    });
    var socket = io.connect();
    var updateReady = true;
    $(document).mousemove(function(event) {
      if(updateReady) {
        socket.emit('mouse', {
          x: event.pageX / w,
          y: event.pageY / h
        });
        updateReady = false;
      }
    });
    setInterval(function() {updateReady = true}, 100); // min time between sending mouse movement
    socket.on('mouseCollection', function (mouseCollection) {
      delete mouseCollection[socket.id]; // don't show myself
      var cursors = $("#cursors");
      for(var id in mouseCollection) {
        if(!$("#" + id).length) {
          // add new cursors
          cursors.append('<img src="cursor.png" id="' + id + '" style="position:absolute;"/>')
        }
        var mouse = mouseCollection[id];
        // update cursors
        $("#" + id).offset({left: mouse.x * w, top: mouse.y * h});
      }
      // remove disconnected cursors
      $("#cursors").children().each(function() {
        if(!(this.id in mouseCollection)) {
          this.remove();
        }
      });
    });
    socket.on('socket.id', function (id) {
      socket.id = id;
    });
  </script>
  <style>
  body {
    overflow:hidden
  }
  h1 {
    font-family: sans-serif;
    font-size: 64px;
  }
  </style>
</head>
<body>
  <h1 style="position: absolute; left: 25%; top: 50%; margin-left: -.5em; margin-top: -.5em" id="plus">+</h1>
  <h1 style="position: absolute; left: 75%; top: 50%; margin-left: -.5em; margin-top: -.5em" id="minus">-</h1>
  <div id="cursors"></div>
</body>
</html>