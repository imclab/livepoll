<html>
<head>
  <title>livepoll</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"> </script>
  <script>
    var packAmount = 1000;
    function packPosition(x) {return Math.floor(x * packAmount);}
    function unpackPosition(x) {return x / packAmount;}

    var w, h;
    $(document).ready(function() {
      w = $(document).width();
      h = $(document).height();
    });
    $(document).resize(function() {
      w = $(document).width();
      h = $(document).height();
    });
    var socket = io.connect();
    var updateReady = true;
    $(document).mousemove(function(event) {
      if(updateReady) {
        socket.emit('m', {
          x: packPosition(event.pageX / w),
          y: packPosition(event.pageY / h)
        });
        updateReady = false;
      }
    });
    setInterval(function() {updateReady = true}, 100); // min time between sending mouse movement
    socket.on('mc', function (mouseCollection) {
      delete mouseCollection[socket.id]; // don't show myself
      var cursors = $("#cursors");
      for(var id in mouseCollection) {
        if(!$("#" + id).length) {
          // add new cursors
          cursors.append('<img src="cursor.png" id="' + id + '" style="position:absolute;"/>')
        }
        var mouse = mouseCollection[id];
        // update cursors
        var x = unpackPosition(mouse.x) * w, y = unpackPosition(mouse.y) * h;
        $("#" + id).offset({left: x, top: y});
      }
      // remove disconnected cursors
      $("#cursors").children().each(function() {
        if(!(this.id in mouseCollection)) {
          this.remove();
        }
      });
    });
    socket.on('id', function (id) {
      socket.id = id;
    });
  </script>
  <style>
  body {
    overflow:hidden
  }
  h1 {
    font-family: sans-serif;
    font-size: 64px;
  }
  .center {
    left: 0;
    line-height: 1em;
    margin-top: -.5em;
    position: absolute;
    text-align: center;
    top: 50%;
    width: 100%;
  }
  </style>
</head>
<body>
  <h1 class="center" id="percentage">50%</h1>
  <h1 class="center" style="left: -30%" id="plus">+</h1>
  <h1 class="center" style="left: +30%" id="minus">-</h1>
  <div id="cursors"></div>
</body>
</html>